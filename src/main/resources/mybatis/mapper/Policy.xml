<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.saonan.mapper.PolicyMapper">
	
	<select id="findPolicyByMoreCondition" parameterType="java.util.Map" statementType="CALLABLE"> 
	
		{call pro_policy(
			#{cp,mode=IN,jdbcType=INTEGER},
			#{ps,mode=IN,jdbcType=INTEGER},
			#{v_id,mode=IN,jdbcType=VARCHAR},
			#{v_name,mode=IN,jdbcType=VARCHAR},
			#{v_area,mode=IN,jdbcType=VARCHAR},
			#{v_lopremium,mode=IN,jdbcType=VARCHAR},
			#{v_hipremium,mode=IN,jdbcType=VARCHAR},
			#{v_date,mode=IN,jdbcType=VARCHAR},
			#{v_lojoindate,mode=IN,jdbcType=VARCHAR},
			#{v_hijoindate,mode=IN,jdbcType=VARCHAR},
			#{v_coverageid,mode=IN,jdbcType=INTEGER},
			#{v_property,mode=IN,jdbcType=VARCHAR},
			#{v_order,mode=IN,jdbcType=VARCHAR},
			#{v_count,mode=OUT,jdbcType=INTEGER},
			#{totalPage,mode=OUT,jdbcType=INTEGER},
			
			#{resource_list,mode=OUT,jdbcType=CURSOR,javaType=ResultSet,resultMap=resource_list}
		)}
		
	</select>
	
	<!-- 自定义结果集(policy) -->
	<resultMap type="cn.saonan.pojo.Policy" id="resource_list">
		<id property="policyid" column="policyid"/>
		<association property="city" column="area" select="cn.saonan.mapper.CityMapper.findCityById"></association>
		<association property="users" column="userid" select="cn.saonan.mapper.UsersMapper.findUserByUserId"></association>
	</resultMap>
	
	<!-- 根据保单编号查询保单 -->
	<select id="findPolicyById" parameterType="java.lang.String" resultMap="resource_list">
		select 
			policyid, insured_name, insured_card, area, address, 
			relation, holder_name, holder_card, holder_sex, holder_phone,
			holder_email, insured_date, license, industry_code, acreage, 
			firm_name, premium, pol_property, del_status, start_date, end_date, 
			yuliu1, yuliu2, userid 
		from policy where policyid = #{policyId}
	</select>
	
	<!-- 将审核通过的投保单信息天道保单中 -->
	<insert id="insertPolicy" parameterType="java.util.Map">
	
		insert into policy
		  (policyid, insured_name, insured_card, area, address, 
		  relation, holder_name, holder_card, holder_sex, holder_phone, 
		  holder_email, insured_date, license, industry_code, acreage, 
		  firm_name, premium, pol_property, del_status, start_date, 
		  end_date, userid)
		values
		  (#{insurance.policyid}, #{insurance.insure_name}, #{insurance.insure_card}, #{insurance.city.code}, #{insurance.address}, 
		  #{insurance.relation}, #{insurance.holder_name}, #{insurance.holder_card}, #{insurance.holder_sex}, #{insurance.holder_phone}, 
		  #{insurance.holder_email}, #{insurance.insure_date}, #{insurance.license}, #{insurance.industry_code}, #{insurance.acreage}, 
		  #{insurance.firm_name}, #{insurance.premium}, #{insurance.pol_property}, #{insurance.del_status}, #{start_date}, 
		  #{end_date}, #{insurance.userid})
		  
	</insert>
	
</mapper>
